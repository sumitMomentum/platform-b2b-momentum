# Setup for Next.js SaaS Dev in Local

## Prerequisites

### NGROK Setup

1. Create an NGROK account.
2. On the NGROK Dashboard (Cloud Edge > Domains), generate a new domain (the first one is free).
3. Run the following command to set up your domain:
   ```bash
   ngrok http --domain=your-personal-domain.ngrok-free.app 3000
   ```
4. Download and install NGROK on your local machine, and set it as an environment variable.
5. Verify the installation by running the NGROK command in the terminal.



### Clerk Setup

1. Create a Clerk account.
2. Create an application (give it any relevant name).
3. Enable organization creation under **Configure > Organization Settings**.
4. Customize the session token under **Configure > Sessions**, click **Edit**, and set the value as:
   ```json
   {"metadata": "{{user.public_metadata}}"}
   ```
5. Create a webhook under **Configure > Webhooks**.
6. Set the custom URL to:
   ```text
   https://<Serverdomain>/en/api/clerk
   ```
   (This is the domain generated by NGROK.)
7. Subscribe to "Organization" and "User" events.
8. **Temporary Super Admin Access** needs to be granted as of now.

### Enode Setup

1. Create an Enode account.
2. Create an organization.
3. Create a client on the Enode Dashboard. Set the client environment to **Sandbox**, and ensure the client and link UI names are the same.

### SQL Setup

1. Download and install MySQL server.
2. Set up and start the server (create a user if it's new).
3. Create a database.


### Code Setup

1. Install all dependencies:
   ```bash
   npm i
   ```

---

## Setting Environment Variables

Set the following environment variables in your `.env` file:

- `DATABASE_URL`  
  Set your local MySQL connection URL:  
  ```text
  mysql://host_name:host_password@localhost:port_number/db_name
  ```

- `NEXT_PUBLIC_DEMO_MODE`  
  Set to `true`.

- `NEXT_PUBLIC_CLERK_WEBHOOK_SECRET`  
  Copy the **Signing Secret** from **Clerk > Configure > Webhooks**.

- `NEXT_PUBLIC_ROOT_DOMAIN`  
  Copy your NGROK domain (the text between `--domain=` and `port_number`).

- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`  
  Copy from **Clerk > Developers > API Keys**.

- `CLERK_SECRET_KEY`  
  Copy from **Clerk > Developers > API Keys**.

- `ENODE_OAUTH_URL`  
  Copy from **Enode Dashboard > client_name > Settings > API Credentials**.

- `ENODE_CLIENT_ID`  
  Copy from **Enode Dashboard > client_name > Settings > API Credentials**.

- `ENODE_CLIENT_SECRET`  
  Copy from **Enode Dashboard > client_name > Settings > API Credentials**.

- `ENODE_BASE_URL`  
  Set as:  
  ```text
  https://enode-api.sandbox.enode.io
  ```

- `ENODE_VEHICLE_ADD_REDIRECT`  
  Set as:  
  ```text
  http://localhost:3000/en/home/vehicles
  ```

---

## Starting the App (In Sequence)

### 1. Start NGROK Local Server

Open the terminal and run:
```bash
ngrok http --domain=your-personal-domain.ngrok-free.app 3000
```

---

### 2. Update the Local Database

1. Open the terminal in the app folder.
2. Install Prisma globally if necessary:
   ```bash
   npm i prisma -g
   ```
3. Populate the database:
   ```bash
   npx prisma migrate dev --name init
   ```

---

### 3. Set Environment Variables (Windows Only - If Required)

Open the terminal and set all environment variables from the `.env` file:
```bash
set variable_name=value
```

---

### 4. Start the App

Open the terminal and run:
```bash
npm run dev
```
